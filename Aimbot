-- Pedrin Hub (Final v3) - Infinite Health, Hotkey Synchronization, and Bug Fixes

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local Teams = game:GetService("Teams")
local UserInputService = game:GetService("UserInputService")

-- GUI
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PedrinHubFinal"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 300, 0, 300)
Frame.Position = UDim2.new(0.5, -150, 0.4, 0)
Frame.BackgroundColor3 = Color3.fromRGB(200, 230, 255)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true

local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1, -40, 0, 25)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "ðŸ§  Pedrin Hub Lite"
Title.TextColor3 = Color3.fromRGB(0, 0, 0)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.TextXAlignment = Enum.TextXAlignment.Left

local Close = Instance.new("TextButton", Frame)
Close.Size = UDim2.new(0, 25, 0, 25)
Close.Position = UDim2.new(1, -30, 0, 0)
Close.Text = "X"
Close.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
Close.TextColor3 = Color3.new(1, 1, 1)
Close.Font = Enum.Font.GothamBold
Close.TextSize = 14

local Minimize = Instance.new("TextButton", Frame)
Minimize.Size = UDim2.new(0, 25, 0, 25)
Minimize.Position = UDim2.new(1, -60, 0, 0)
Minimize.Text = "_"
Minimize.BackgroundColor3 = Color3.fromRGB(255, 200, 80)
Minimize.TextColor3 = Color3.new(1, 1, 1)
Minimize.Font = Enum.Font.GothamBold
Minimize.TextSize = 14

local OpenBtn = Instance.new("TextButton", ScreenGui)
OpenBtn.Size = UDim2.new(0, 30, 0, 30)
OpenBtn.Position = UDim2.new(0, 10, 0.5, 0)
OpenBtn.Text = "+"
OpenBtn.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
OpenBtn.TextColor3 = Color3.new(1, 1, 1)
OpenBtn.Font = Enum.Font.GothamBold
OpenBtn.TextSize = 20
OpenBtn.Visible = false

Close.MouseButton1Click:Connect(function()
    Frame.Visible = false
    OpenBtn.Visible = true
end)

Minimize.MouseButton1Click:Connect(function()
    Frame.Visible = false
    OpenBtn.Visible = true
end)

OpenBtn.MouseButton1Click:Connect(function()
    Frame.Visible = true
    OpenBtn.Visible = false
end)

local toggles = {}

local function CreateToggle(labelText, hotkey, yPos, callback)
    local toggle = Instance.new("TextButton", Frame)
    toggle.Size = UDim2.new(0, 260, 0, 30)
    toggle.Position = UDim2.new(0, 20, 0, yPos)
    toggle.BackgroundColor3 = Color3.fromRGB(235, 235, 255)
    toggle.TextColor3 = Color3.fromRGB(0, 0, 0)
    toggle.Font = Enum.Font.Gotham
    toggle.TextSize = 14
    toggle.Text = labelText .. " (OFF) [" .. hotkey .. "]"

    local enabled = false
    toggles[hotkey] = function(state)
        enabled = state
        toggle.Text = labelText .. " (" .. (enabled and "ON" or "OFF") .. ") [" .. hotkey .. "]"
        callback(enabled)
    end

    toggle.MouseButton1Click:Connect(function()
        enabled = not enabled
        toggles[hotkey](enabled)
    end)
end

-- Variables
local SpeedHack = false
local AimbotActive = false
local ESPActive = false
local InfiniteHealth = false
local SpeedValue = 90
local AimbotSmoothness = 0.3 -- Adjust the smoothness of the Aimbot (0.1 = smoother, 1 = stronger)
local esp_objects = {}

-- Detect if it's FFA (Free For All)
local function IsFFA()
    return not Teams or #Teams:GetChildren() <= 1
end

-- Speed Hack
RunService.Heartbeat:Connect(function()
    if SpeedHack then
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("Humanoid") then
            local hum = char:FindFirstChild("Humanoid")
            if hum.WalkSpeed ~= SpeedValue then
                hum.WalkSpeed = SpeedValue
            end
        end
    end
end)

-- Infinite Health
RunService.Heartbeat:Connect(function()
    if InfiniteHealth then
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("Humanoid") then
            char.Humanoid.Health = char.Humanoid.MaxHealth
        end
    end
end)

-- Ensure speed on respawn
LocalPlayer.CharacterAdded:Connect(function(char)
    local humanoid = char:WaitForChild("Humanoid", 5)
    if humanoid then
        humanoid.WalkSpeed = SpeedHack and SpeedValue or 16
    end
end)

-- Aimbot
local function FindTarget()
    local closestDistance = math.huge
    local target = nil
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Head") and p.Character:FindFirstChild("Humanoid") then
            if p.Character.Humanoid.Health > 0 then
                local isEnemy = IsFFA() or (p.Team ~= LocalPlayer.Team)
                if isEnemy then
                    local distance = (Camera.CFrame.Position - p.Character.Head.Position).Magnitude
                    if distance < closestDistance then
                        closestDistance = distance
                        target = p.Character.Head
                    end
                end
            end
        end
    end
    return target
end

-- Render Loop
RunService.RenderStepped:Connect(function()
    if AimbotActive then
        local target = FindTarget()
        if target then
            local targetPos = target.Position
            local cameraPos = Camera.CFrame.Position
            local newPos = cameraPos:Lerp(targetPos, AimbotSmoothness)
            Camera.CFrame = CFrame.new(cameraPos, newPos)
        end
    end
end)

-- Hotkeys
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    local hotkey = input.KeyCode.Name
    if toggles[hotkey] then
        toggles[hotkey](not toggles[hotkey].state)
    end
end)

-- Buttons with hotkeys displayed
CreateToggle("Speed Hack", "Z", 40, function(v) SpeedHack = v end)
CreateToggle("Aimbot", "X", 80, function(v) AimbotActive = v end)
CreateToggle("ESP", "C", 120, function(v) ESPActive = v end)
CreateToggle("Infinite Health", "V", 160, function(v) InfiniteHealth = v end)

print("[Pedrin Hub] âœ… Infinite Health, Hotkey Synchronization, and Bug Fixes Applied!")
