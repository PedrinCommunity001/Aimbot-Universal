-- Pedrin Hub (Final v3) - Hotkeys corrigidas, design aprimorado e movimenta√ß√£o simplificada

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera
local Teams = game:GetService("Teams")
local UserInputService = game:GetService("UserInputService")

-- GUI
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PedrinHubFinal"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 350, 0, 400)
Frame.Position = UDim2.new(0.5, -175, 0.4, 0)
Frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Frame.BorderSizePixel = 0
Frame.Active = true

local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
Title.Text = "üß† Pedrin Hub - Melhorado"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.TextXAlignment = Enum.TextXAlignment.Center

local Close = Instance.new("TextButton", Frame)
Close.Size = UDim2.new(0, 30, 0, 30)
Close.Position = UDim2.new(1, -35, 0, 5)
Close.Text = "X"
Close.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
Close.TextColor3 = Color3.new(1, 1, 1)
Close.Font = Enum.Font.GothamBold
Close.TextSize = 14

local Minimize = Instance.new("TextButton", Frame)
Minimize.Size = UDim2.new(0, 30, 0, 30)
Minimize.Position = UDim2.new(1, -70, 0, 5)
Minimize.Text = "_"
Minimize.BackgroundColor3 = Color3.fromRGB(255, 200, 80)
Minimize.TextColor3 = Color3.new(1, 1, 1)
Minimize.Font = Enum.Font.GothamBold
Minimize.TextSize = 14

local OpenBtn = Instance.new("TextButton", ScreenGui)
OpenBtn.Size = UDim2.new(0, 30, 0, 30)
OpenBtn.Position = UDim2.new(0, 10, 0.5, 0)
OpenBtn.Text = "+"
OpenBtn.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
OpenBtn.TextColor3 = Color3.new(1, 1, 1)
OpenBtn.Font = Enum.Font.GothamBold
OpenBtn.TextSize = 20
OpenBtn.Visible = false

Close.MouseButton1Click:Connect(function()
    Frame.Visible = false
    OpenBtn.Visible = true
end)

Minimize.MouseButton1Click:Connect(function()
    Frame.Visible = false
    OpenBtn.Visible = true
end)

OpenBtn.MouseButton1Click:Connect(function()
    Frame.Visible = true
    OpenBtn.Visible = false
end)

-- Movimenta√ß√£o simplificada do hub
local dragging, dragInput, dragStart, startPos
Frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = Frame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

Frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

local toggles = {}

local function CreateToggle(labelText, hotkey, yPos, callback)
    local toggle = Instance.new("TextButton", Frame)
    toggle.Size = UDim2.new(0, 300, 0, 40)
    toggle.Position = UDim2.new(0, 25, 0, yPos)
    toggle.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggle.Font = Enum.Font.Gotham
    toggle.TextSize = 14
    toggle.Text = labelText .. " (OFF) [" .. hotkey .. "]"

    local enabled = false
    toggles[hotkey] = function(state)
        enabled = state
        toggle.Text = labelText .. " (" .. (enabled and "ON" or "OFF") .. ") [" .. hotkey .. "]"
        callback(enabled)
    end

    toggle.MouseButton1Click:Connect(function()
        enabled = not enabled
        toggles[hotkey](enabled)
    end)
end

-- Vari√°veis
local SpeedHack = false
local AimbotAtivo = false
local ESPAtivo = false
local InfiniteHealth = false
local SpeedValue = 90
local AimbotSuavidade = 0.3 -- Ajuste a suavidade do Aimbot (0.1 = mais suave, 1 = mais forte)
local esp_objects = {}

-- Detectar se √© FFA (sem times)
local function IsFFA()
    return not Teams or #Teams:GetChildren() <= 1
end

-- Speed Hack
RunService.Heartbeat:Connect(function()
    if SpeedHack then
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("Humanoid") then
            local hum = char:FindFirstChild("Humanoid")
            if hum.WalkSpeed ~= SpeedValue then
                hum.WalkSpeed = SpeedValue
            end
        end
    end
end)

-- Vida infinita
RunService.Heartbeat:Connect(function()
    if InfiniteHealth then
        local char = LocalPlayer.Character
        if char and char:FindFirstChild("Humanoid") then
            char.Humanoid.Health = char.Humanoid.MaxHealth
        end
    end
end)

-- Garantir velocidade no respawn
LocalPlayer.CharacterAdded:Connect(function(char)
    local humanoid = char:WaitForChild("Humanoid", 5)
    if humanoid then
        humanoid.WalkSpeed = SpeedHack and SpeedValue or 16
    end
end)

-- Aimbot
local function EncontrarAlvo()
    local menorDist = math.huge
    local alvo = nil
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("Head") and p.Character:FindFirstChild("Humanoid") then
            if p.Character.Humanoid.Health > 0 then
                local ehInimigo = IsFFA() or (p.Team ~= LocalPlayer.Team)
                if ehInimigo then
                    local dist = (Camera.CFrame.Position - p.Character.Head.Position).Magnitude
                    if dist < menorDist then
                        menorDist = dist
                        alvo = p.Character.Head
                    end
                end
            end
        end
    end
    return alvo
end

-- Render Loop
RunService.RenderStepped:Connect(function()
    if AimbotAtivo then
        local alvo = EncontrarAlvo()
        if alvo then
            local alvoPos = alvo.Position
            local cameraPos = Camera.CFrame.Position
            local novaPos = cameraPos:Lerp(alvoPos, AimbotSuavidade)
            Camera.CFrame = CFrame.new(cameraPos, novaPos)
        end
    end
end)

-- Hotkeys
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    local hotkey = input.KeyCode.Name
    if toggles[hotkey] then
        toggles[hotkey](not toggles[hotkey].state)
    end
end)

-- Bot√µes com hotkeys exibidos
CreateToggle("Speed Hack", "Z", 60, function(v) SpeedHack = v end)
CreateToggle("Aimbot", "X", 120, function(v) AimbotAtivo = v end)
CreateToggle("ESP", "C", 180, function(v) ESPAtivo = v end)
CreateToggle("Infinite Health", "V", 240, function(v) InfiniteHealth = v end)

print("[Pedrin Hub] ‚úÖ Melhorias aplicadas com sucesso!")
